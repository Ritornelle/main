<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggregate Album Ratings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .album-list {
            list-style: none;
            padding: 0;
        }
        .album-item {
            margin-bottom: 10px;
        }
        .album-item span {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Album Ratings</h1>
    <ul id="albumList" class="album-list"></ul>

    <script>
        // Array of paths to your HTML pages
        const pages = ['albums-of-2025.html', 'albums-of-2024.html', 'albums-of-2023']; // Replace with actual paths to your pages

async function fetchAlbumData() {
    const albumList = document.getElementById('albumList');
    const allAlbums = []; // Array to collect all albums before sorting

    // Helper function to parse ratings with fractions to decimal
    function parseRating(ratingText) {
        const text = ratingText.trim();
        
        // Replace fraction symbols with decimal equivalents
        let normalized = text
            .replace(/¾/g, '.75')
            .replace(/½/g, '.5')
            .replace(/¼/g, '.25')
            // Add more if needed, e.g., .replace(/⅓/g, '.\overline{3}') but approximate if desired
        
        // Now parse as float (handles decimals/integers too)
        const rating = parseFloat(normalized);
        
        // Return only if valid
        return isNaN(rating) ? null : rating;
    }

    for (const page of pages) {
        try {
            const response = await fetch(page);
            if (!response.ok) throw new Error(`Failed to fetch ${page}`);
            const text = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');

            // Select all album elements
            const albums = doc.querySelectorAll('.album');

            albums.forEach(album => {
                const ratingText = album.querySelector('.album-rating').textContent.trim();
                const artist = album.querySelector('.album-text h3:nth-child(1)').textContent.trim();
                const albumName = album.querySelector('.album-text h3:nth-child(2)').textContent.trim();
                const rating = parseRating(ratingText); // Use custom parser

                // Only add if parsing succeeded
                if (rating !== null) {
                    allAlbums.push({ artist, albumName, rating, ratingText });
                }
            });
        } catch (error) {
            console.error(`Error processing ${page}:`, error);
        }
    }

    // Sort by rating descending (highest first)
    allAlbums.sort((a, b) => b.rating - a.rating);

    // Now append the sorted items to the list
    allAlbums.forEach(({ artist, albumName, ratingText }) => {
        const li = document.createElement('li');
        li.className = 'album-item';
        li.innerHTML = `<span>${artist}</span> - ${albumName} (Rating: ${ratingText})`;
        albumList.appendChild(li);
    });
}

        // Run the function when the page loads
        window.onload = fetchAlbumData;
    </script>
</body>
</html>