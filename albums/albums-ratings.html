<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggregate Album Ratings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .album-list {
            list-style: none;
            padding: 0;
            font-size: 12px; /* Smaller font size as per previous request */
        }
        .album-item {
            margin-bottom: 0;
        }
        .album-item span {
            font-weight: bold;
        }
        .album-list li:empty {
            margin-bottom: 1em; /* For blank line spacing */
        }
    </style>
</head>
<body>
    <h1>Album Ratings</h1>
    <ul id="albumList" class="album-list"></ul>

    <script>
        // Array of paths to your HTML pages
        const pages = ['albums-of-2025.html', 'albums-of-2024.html', 'albums-of-2023.html', 'albums-of-2022.html', 'albums-of-2021.html', 'albums-of-2020.html', 
        'albums-of-2019.html', 'albums-of-2018.html', 'albums-of-2017.html', 'albums-of-2016.html', 'albums-of-2015.html',
        'albums-of-2014.html', 'albums-of-2013.html', 'albums-of-2012.html', 'albums-of-2011.html', 'albums-of-2010.html',
        'albums-of-2009.html', 'albums-of-2008.html', 'albums-of-2007.html', 'albums-of-2006.html', 'albums-of-2005.html',
        'albums-of-2004.html', 'albums-of-2003.html', 'albums-of-2002.html', 'albums-of-2001.html', 'albums-of-2000.html',
        'albums-of-1999.html', 'albums-of-1998.html', 'albums-of-1997.html', 'albums-of-1996.html', 'albums-of-1995.html',
        'albums-of-1994.html', 'albums-of-1993.html', 'albums-of-1992.html', 'albums-of-1991.html', 'albums-of-1990.html',
        'albums-of-1989.html', 'albums-of-1988.html', 'albums-of-1987.html', 'albums-of-1986.html', 'albums-of-1985.html',
        'albums-of-1984.html', 'albums-of-1983.html', 'albums-of-1982.html', 'albums-of-1981.html', 'albums-of-1980.html',
        'albums-of-1979.html', 'albums-of-1978.html', 'albums-of-1977.html', 'albums-of-1976.html', 'albums-of-1975.html',
        'albums-of-1974.html', 'albums-of-1973.html', 'albums-of-1972.html', 'albums-of-1971.html', 'albums-of-1970.html',
        'albums-of-1969.html', 'albums-of-1968.html', 'albums-of-1967.html', 'albums-of-1966.html', 'albums-of-1965.html',
        'albums-of-1964.html', 'albums-of-1963.html', 'albums-of-1962.html', 'albums-of-1961.html', 'albums-of-1960.html',
        'albums-of-1959.html', 'albums-of-1958.html', 'albums-of-1957.html', 'albums-of-1956.html', 'albums-of-1955.html',
        'albums-of-1954.html', 'albums-of-1953.html', 'albums-of-1952.html', 'albums-of-1951.html', 'albums-of-1950.html',
        'albums-of-1949.html', 'albums-of-1948.html', 'albums-of-1947.html', 'albums-of-1946.html', 'albums-of-1945.html',
        'albums-of-1944.html', 'albums-of-1943.html', 'albums-of-1942.html', 'albums-of-1941.html', 'albums-of-1940.html'];

        async function fetchAlbumData() {
            const albumList = document.getElementById('albumList');
            const allAlbums = []; // Array to collect all albums before sorting

            // Helper function to parse ratings with fractions to decimal
            function parseRating(ratingText) {
                const text = ratingText.trim();
                
                // Replace fraction symbols with decimal equivalents
                let normalized = text
                    .replace(/¾/g, '.75')
                    .replace(/½/g, '.5')
                    .replace(/¼/g, '.25');
                
                // Now parse as float (handles decimals/integers too)
                const rating = parseFloat(normalized);
                
                // Return only if valid
                return isNaN(rating) ? null : rating;
            }

            // Helper function to extract year from page filename
            function extractYear(page) {
                const match = page.match(/albums-of-(\d{4})\.html/);
                return match ? match[1] : 'Unknown';
            }

            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    if (!response.ok) throw new Error(`Failed to fetch ${page}`);
                    const text = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');

                    // Select all album elements
                    const albums = doc.querySelectorAll('.album');
                    const year = extractYear(page); // Extract year for this page

                    albums.forEach(album => {
                        const ratingText = album.querySelector('.album-rating').textContent.trim();
                        const artist = album.querySelector('.album-text h3:nth-child(1)').textContent.trim();
                        const albumName = album.querySelector('.album-text h3:nth-child(2)').textContent.trim();
                        const rating = parseRating(ratingText); // Use custom parser

                        // Only add if parsing succeeded
                        if (rating !== null) {
                            allAlbums.push({ artist, albumName, rating, ratingText, year });
                        }
                    });
                } catch (error) {
                    console.error(`Error processing ${page}:`, error);
                }
            }

            // Sort by rating descending, then by artist ascending for equal ratings
            allAlbums.sort((a, b) => {
                if (a.rating !== b.rating) {
                    return b.rating - a.rating; // Primary: descending by rating
                }
                return a.artist.localeCompare(b.artist); // Secondary: alphabetical by artist
            });

            // Now append the items to the list, adding a blank line between rating changes
            let previousRating = null;
            allAlbums.forEach(({ artist, albumName, ratingText, rating, year }, index) => {
                // Add a blank line if the rating has changed (and it's not the first item)
                if (previousRating !== null && rating !== previousRating) {
                    const blankLi = document.createElement('li');
                    blankLi.style.height = '1em'; // Adjust height for spacing
                    albumList.appendChild(blankLi);
                }

                // Create and append the album item with year
                const li = document.createElement('li');
                li.className = 'album-item';
                li.innerHTML = `<span>${artist}</span> - ${albumName} (Rating: ${ratingText}, Year: ${year})`;
                albumList.appendChild(li);

                // Update the previous rating
                previousRating = rating;
            });
        }

        // Run the function when the page loads
        window.onload = fetchAlbumData;
    </script>
</body>
</html>